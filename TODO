
- start pinning down behavior by actually writing tests for these various cases
    - basic attach test
    - attach, then reconnect
    - attach, write exit to the shell
    - test for ssh plugin mode commands
- forward signals to the inner shell correctly
- Something is fucky with how eagarly we are reading the input and output
  from the termianl input/shell. I generally have to mash return a few times
  to se output for my commands.
- come up with some sort of keybinding to exit the shpool shell.
  make it configurable via the daemon's toml file. (Or maybe just
  make users use commands to do this? That won't work for long running
  processes though).
- Pass TERM along so that `reset` works
- make a centralized chunk writing thread so that writes do not
  get interleaved for data coming from the daemon to the client.
- Read input from terminal emulator byte by byte so that zsh autocomplete
  works.
- There is a lot of heartbeat overhead. See if we can reduce that.


- Get ssh extension mode to work for reconnect. Currently it only works
  for the initial connection.
- Get ssh extension mode to be compatible with ssh multiplexing so
  it only requires a single gnubby touch.
```
Host = ct-shpool
    Hostname pailes.c.googlers.com

    # enable ssh multiplexing so that we only need one gnubby touch
    #
    # TODO(ethan): this seems to cause trouble because the LocalCommand
    #              does not work when I have multiplexing enabled.
    #
    # ControlPath ~/.ssh/sudp-cm-%r@%h:%p
    # ControlMaster auto
    # ControlPersist 10m # stay open after the initial conn closes for 10m

    RemoteCommand /usr/local/google/home/pailes/bin/shpool -vv --log-file /tmp/shpool-ssh-remote-command.log plumbing ssh-remote-command
    PermitLocalCommand yes
    LocalCommand ssh -oPermitLocalCommand=no -oRemoteCommand="/usr/local/google/home/pailes/bin/shpool -vv --log-file /tmp/shpool-ssh-local-command-set-name.log plumbing ssh-local-command-set-name '%u@%h:%p$(tty)'" %n
```
